(this["webpackJsonpreact-rogue"]=this["webpackJsonpreact-rogue"]||[]).push([[0],{27:function(t,e,i){"use strict";i.r(e);var a=i(10),s=i(18),n=i.n(s),r=i(8),h=i(0),o=i(1),c=function(){function t(){var e=this;Object(h.a)(this,t),this.observers=[],this.handleKeys=function(t){switch(t.preventDefault(),t.keyCode){case 37:e.broadcast("move-left",{x:-1,y:0});break;case 38:e.broadcast("move-up",{x:0,y:-1});break;case 39:e.broadcast("move-right",{x:1,y:0});break;case 40:e.broadcast("move-down",{x:0,y:1})}}}return Object(o.a)(t,[{key:"subscribe",value:function(t){this.observers.push(t)}},{key:"unsubscribe",value:function(t){this.observers=this.observers.filter((function(e){return e!==t}))}},{key:"broadcast",value:function(t,e){this.observers.forEach((function(i){i(t,e)}))}},{key:"bindKeys",value:function(){document.addEventListener("keydown",this.handleKeys)}},{key:"unbindKeys",value:function(){document.removeEventListener("keydown",this.handleKeys)}}]),t}(),l={ERROR:-1,NOTHING:0,WALL:1,PLAYER:2,LOOT:3,GOBLIN:4,OGRE:5,ORC:6,TROLL:7,STAIRS:99,UNKNOWN:999};Object.freeze(l);var u=l,f={TOPLEFTQUAD:1,TOPRIGHTQUAD:2,BOTTOMRIGHTQUAD:3,BOTTOMLEFTQUAD:4,MIDDLE:5,RANDOM:999};Object.freeze(f);var y=f,d=i(4),v=i(3),b=i(20),p=function(){function t(e,i,a){Object(h.a)(this,t),this.x=e,this.y=i,this.attributes=Object(b.a)({},a)}return Object(o.a)(t,[{key:"collide",value:function(t,e,i){this.action("collide",{x:t,y:e},i)}},{key:"action",value:function(t,e,i){console.log("Verb: ".concat(t," with data: ").concat(e," unhandled on ").concat(this.attributes?this.attributes.name:"no name"))}},{key:"draw",value:function(t){t.fillStyle=this.attributes.colour||"white",t.textBaseline="hanging",t.font="16px Helvetica",t.fillText(this.attributes.ascii,this.x*this.attributes.size+(this.attributes.offset?this.attributes.offset.x:0),this.y*this.attributes.size+(this.attributes.offset?this.attributes.offset.y:0))}}]),t}(),O={type:u.PLAYER,name:"Player",ascii:"@",size:16,colour:"orange",health:10},w=function(t){Object(d.a)(i,t);var e=Object(v.a)(i);function i(t,a){var s;return Object(h.a)(this,i),(s=e.call(this,t,a,O)).inventory=[],s}return Object(o.a)(i,[{key:"move",value:function(t,e,i){this.attributes.health<=0||(t.worldMap.delete(this.x,this.y),this.x+=e,this.y+=i,t.worldMap.put(this.x,this.y,this))}},{key:"action",value:function(t,e,i){if("collide"===t){var a=i.whatsAt(e.x,e.y);switch(a.attributes?a.attributes.type:a){case u.LOOT:this.addInventory(a),i.remove(a);break;case u.OGRE:case u.ORC:case u.GOBLIN:case u.TROLL:a.action("hit",{},i);break;case u.STAIRS:a.action("interact",{},i)}}}},{key:"addInventory",value:function(t){this.inventory.push(t)}},{key:"dropInventory",value:function(t){this.inventory=this.inventory.filter((function(e){return e!==t}))}}]),i}(p),m=[{type:u.LOOT,name:"Longsword",colour:"darkgrey",ascii:"/",size:16,offset:{x:6,y:3}},{type:u.LOOT,name:"Health",colour:"red",ascii:"!",size:16,offset:{x:6,y:3}},{type:u.LOOT,name:"Gold",colour:"yellow",ascii:"$",size:16,offset:{x:3,y:3}},{type:u.LOOT,name:"Light Armour",colour:"lightgrey",size:16,ascii:"#",offset:{x:4,y:3}}],k=function(t){Object(d.a)(i,t);var e=Object(v.a)(i);function i(t,a){Object(h.a)(this,i);var s=m[Math.floor(Math.random()*m.length)];return e.call(this,t,a,s)}return i}(p),g=[{type:u.ORC,name:"Orc",colour:"darkgrey",ascii:"W",size:16,offset:{x:6,y:3},health:5},{type:u.OGRE,name:"Ogre",colour:"red",ascii:"%",size:16,offset:{x:6,y:3},health:6},{type:u.GOBLIN,name:"Goblin",colour:"yellow",ascii:"^",size:16,offset:{x:3,y:3},health:4},{type:u.TROLL,name:"Troll",colour:"lightgrey",size:16,ascii:"&",offset:{x:4,y:3},health:9}],T=function(t){Object(d.a)(i,t);var e=Object(v.a)(i);function i(t,a){Object(h.a)(this,i);var s=g[Math.floor(Math.random()*g.length)];return e.call(this,t,a,s)}return Object(o.a)(i,[{key:"action",value:function(t,e,i){switch(t){case"hit":i.addToHistory("Player attacks ".concat(this.attributes.name,"!")),this.attributes.health-=1,this.attributes.health<=0?(i.addToHistory("".concat(this.attributes.name," dies!")),i.remove(this)):i.addToHistory("".concat(this.attributes.name,"'s health = ").concat(this.attributes.health)),i.player.attributes.health-=1,i.player.attributes.health<=0?i.addToHistory("That attack drained the last few drops of your life force. The player is dead!"):i.addToHistory("Player health is now ".concat(i.player.attributes.health))}}}]),i}(p),M={type:u.STAIRS,name:"Stairs",colour:"black",ascii:"v",size:16,offset:{x:2,y:2}},j=function(t){Object(d.a)(i,t);var e=Object(v.a)(i);function i(t,a){return Object(h.a)(this,i),e.call(this,t,a,M)}return Object(o.a)(i,[{key:"action",value:function(t,e,i){"interact"===t&&(i.addToHistory("Descending..."),i.newLevel(i.level-1),i.addToHistory("Level ".concat(i.level)))}}]),i}(p),R=function(){function t(){Object(h.a)(this,t)}return Object(o.a)(t,[{key:"spawn",value:function(t,e,i,a){for(var s=0;s<e;s++){var n=a();t.addWithLocationHint(n,i)}}},{key:"spawnPlayer",value:function(t){this.spawn(t,1,y.TOPLEFTQUAD,(function(){return new w}))}},{key:"spawnLoot",value:function(t,e){this.spawn(t,e,y.RANDOM,(function(){return new k}))}},{key:"spawnMonsters",value:function(t,e){this.spawn(t,e,y.RANDOM,(function(){return new T}))}},{key:"spawnStairs",value:function(t,e){this.spawn(t,e,y.BOTTOMRIGHTQUAD,(function(){return new j}))}}]),t}(),L=i(19),x=function(){function t(e,i){Object(h.a)(this,t),this.width=e,this.height=i,this.map=new Array(e);for(var a=0;a<this.width;a++)this.map[a]=new Array(i)}return Object(o.a)(t,[{key:"newMap",value:function(){for(var t=this,e=0;e<this.width;e++)this.map[e]=new Array(this.height);var i=new L.a.Cellular(this.width,this.height,{connected:!0});i.randomize(.5);var a=function(e,i,a){0!==e&&0!==i&&e!==t.width-1&&i!==t.height-1?t.map[e][i]=0===a?u.WALL:u.NOTHING:t.map[e][i]=1};i.create(a),i.connect(a,1)}},{key:"valid",value:function(t,e){return!isNaN(t)&&!isNaN(e)&&!(t<0||t>this.map.length-1||e<0||e>this.map[0].length-1)}},{key:"get",value:function(t,e){return this.valid(t,e)?this.map[t][e]:u.ERROR}},{key:"put",value:function(t,e,i){if(!this.valid(t,e))return u.ERROR;this.map[t][e]=i}},{key:"putApproximately",value:function(t,e){var i=-1,a=-1,s=-1,n=-1;switch(t){case y.TOPLEFTQUAD:i=1,s=Math.floor(this.width/2),a=1,n=Math.floor(this.height/2);break;case y.TOPRIGHTQUAD:i=Math.floor(this.width/2),s=Math.floor(this.width-1),a=1,n=Math.floor(this.height/2);break;case y.BOTTOMRIGHTQUAD:i=Math.floor(this.width/2),s=Math.floor(this.width-1),a=Math.floor(this.height/2),n=this.height-1;break;case y.BOTTOMLEFTQUAD:i=1,s=Math.floor(this.width/2),a=Math.floor(this.height/2),n=Math.floor(this.height-1);break;case y.MIDDLE:s=3*(i=Math.floor(this.width/4)),n=3*(a=Math.floor(this.height/4));break;case y.RANDOM:i=1,s=this.width-1,a=1,n=this.height-1}if(i<0||s<0||a<0||n<0)console.log("Couldn't determine WorldLocationHint (".concat(t,")"));else{for(var r=!1,h=0,o=0;!r;)if(h=this.randomRange(i,s),o=this.randomRange(a,n),this.get(h,o)===u.NOTHING){r=!0;break}e.x=h,e.y=o,this.put(h,o,e)}}},{key:"delete",value:function(t,e){if(!this.valid(t,e))return u.ERROR;this.map[t][e]=u.NOTHING}},{key:"findRandomSpace",value:function(t){for(var e=t?this.randomRange(t.x,this.width):this.randomRange(0,this.width-1),i=t?this.randomRange(t.y,this.height):this.randomRange(0,this.height-1),a=0,s=!1;!s&&a<100;){if(this.get(e,i)===u.NOTHING){s=!0;break}e=this.randomRange(e,this.width-1),i=this.randomRange(i,this.height-1),a++}return s?{x:e,y:i}:this.findRandomSpace()}},{key:"randomRange",value:function(t,e){return Math.floor(t+Math.random()*(e-t))}}]),t}(),A=function(){function t(e,i,a){Object(h.a)(this,t),this.level=0,this.width=e,this.height=i,this.tileSize=a,this.entities=[],this.history=[],this.levels=[],this.worldMap=new x(e,i),this.spawner=new R(this)}return Object(o.a)(t,[{key:"player",get:function(){return this.entities.filter((function(t){return t.attributes.type==u.PLAYER}))[0]}},{key:"movePlayer",value:function(t,e){var i=t+this.player.x,a=e+this.player.y,s=this.worldMap.get(i,a);switch(s.attributes?s.attributes.type:s){case u.WALL:break;case u.NOTHING:this.player.move(this,t,e);break;case u.OGRE:case u.ORC:case u.GOBLIN:case u.TROLL:this.player.collide(i,a,this);break;default:this.player.collide(i,a,this),this.player.move(this,t,e)}}},{key:"whatsAt",value:function(t,e){return this.worldMap.get(t,e)}},{key:"newLevel",value:function(t){var e=new w;Object.assign(e,this.player);var i=new x;Object.assign(i,this.worldMap),this.levels.push({level:this.level,map:i}),this.level=t,this.createMap(),this.spawnPlayer(),this.spawnLoot(),this.spawnMonsters(),this.spawnStairs(),this.player.inventory=e.inventory}},{key:"createMap",value:function(){this.entities=[],this.worldMap.newMap()}},{key:"spawnPlayer",value:function(){this.spawner.spawnPlayer(this,1)}},{key:"spawnLoot",value:function(t){this.spawner.spawnLoot(this,Math.floor(Math.random()*(t||8)))}},{key:"spawnMonsters",value:function(t){this.spawner.spawnMonsters(this,Math.floor(Math.random()*(t||8)))}},{key:"spawnStairs",value:function(t){this.spawner.spawnStairs(this,t||1)}},{key:"addWithLocationHint",value:function(t,e){this.worldMap.putApproximately(e||y.RANDOM,t),this.entities.push(t)}},{key:"add",value:function(t){return this.addWithLocationHint(t,y.RANDOM),!0}},{key:"remove",value:function(t){this.entities=this.entities.filter((function(e){return e!==t})),this.worldMap.delete(t.x,t.y)}},{key:"addToHistory",value:function(t){this.history.push(t),this.history.length>6&&this.history.shift()}},{key:"draw",value:function(t){for(var e=0;e<this.width;e++)for(var i=0;i<this.height;i++)this.worldMap.get(e,i)===u.WALL&&this.drawWall(t,e,i),this.worldMap.get(e,i)===u.NOTHING&&this.drawSpace(t,e,i);this.entities.forEach((function(e){e.draw(t)}))}},{key:"drawWall",value:function(t,e,i){t.fillStyle="#000",t.fillRect(e*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize)}},{key:"drawSpace",value:function(t,e,i){t.fillStyle="DimGray",t.fillRect(e*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize),t.fillText(" ",e*this.tileSize,i*this.tileSize)}}]),t}(),S=i(7),N=function(t){var e=t.width,i=t.height,s=t.tileSize,n=Object(a.useRef)(),h=Object(a.useState)(new A(e,i,s)),o=Object(r.a)(h,2),l=o[0],u=o[1],f=new c,y=function(t,e){var i=new A;Object.assign(i,l),i.movePlayer(e.x,e.y),u(i)};return Object(a.useEffect)((function(){var t=new A;Object.assign(t,l),t.createMap(),t.spawnPlayer(),t.spawnLoot(),t.spawnMonsters(),t.spawnStairs(),t.addToHistory("Level ".concat(t.level,"!")),u(t)}),[]),Object(a.useEffect)((function(){return f.bindKeys(),f.subscribe(y),function(){f.unbindKeys(),f.unsubscribe(y)}})),Object(a.useEffect)((function(){var t=n.current.getContext("2d");t.clearRect(0,0,e*s,i*s),l.draw(t)})),Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("canvas",{ref:n,width:e*s,height:i*s,style:{border:"1px solid black",background:"DimGray"}}),Object(S.jsx)("ul",{children:l.player&&l.player.inventory.map((function(t,e){return Object(S.jsx)("li",{children:t.attributes.name},e)}))}),Object(S.jsx)("ul",{children:l.history&&l.history.map((function(t,e){return Object(S.jsx)("li",{children:t},e)}))})]})},z=function(){return Object(S.jsx)("div",{className:"App",children:Object(S.jsx)(N,{width:40,height:40,tileSize:16})})};n.a.render(Object(S.jsx)(z,{}),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.ac9d52d3.chunk.js.map